import{r as n,u as _,j as s,D as ee,a as se,b as ae,c as re,d as oe,L as i,I as j,C as v,R as te,e as b,f as E,g as ie,B as A,h as ne,t as $}from"./index-B8CROVc0.js";const D=[{nome:"Azul",valor:"#93C5FD"},{nome:"Verde",valor:"#86EFAC"},{nome:"Amarelo",valor:"#FDE047"},{nome:"Rosa",valor:"#F9A8D4"},{nome:"Roxo",valor:"#C4B5FD"},{nome:"Dourado",valor:"#D3AF37"}],C=["Assessoria","Comercial","Obras"];function le({open:L,onClose:f,onSuccess:B}){const[c,I]=n.useState("09:00"),[l,S]=n.useState("11:00"),[d,y]=n.useState("uteis"),[m,T]=n.useState(""),[h,V]=n.useState(""),[x,w]=n.useState("5"),[H,k]=n.useState(D[0].valor),[u,g]=n.useState([]),[p,M]=n.useState(!1),[o,t]=n.useState({}),{mutate:G,loading:N}=_(),z=()=>{const e={};if(!c)e.horaInicio="Hora de início é obrigatória";else if(!/^\d{2}:\d{2}$/.test(c))e.horaInicio="Formato inválido (use HH:MM)";else{const[a]=c.split(":").map(Number);(a<8||a>18)&&(e.horaInicio="Deve estar entre 08:00 e 18:00")}if(!l)e.horaFim="Hora de fim é obrigatória";else if(!/^\d{2}:\d{2}$/.test(l))e.horaFim="Formato inválido (use HH:MM)";else if(l<=c)e.horaFim="Deve ser após a hora de início";else{const[a]=l.split(":").map(Number);a>18&&(e.horaFim="Deve ser até 18:00");const[r,F]=c.split(":").map(Number),[Y,Z]=l.split(":").map(Number),R=Y+Z/60-(r+F/60);R<.5?e.horaFim="Duração mínima é 30 minutos":R>4&&(e.horaFim="Duração máxima é 4 horas")}return t(a=>({...a,...e})),Object.keys(e).length===0},P=()=>{if(d!=="custom")return!0;const e={},a=new Date().toISOString().split("T")[0];return m?m<a&&(e.dataInicio="Deve ser uma data futura"):e.dataInicio="Data de início é obrigatória",h?h<m?e.dataFim="Deve ser após a data de início":Math.floor((new Date(h).getTime()-new Date(m).getTime())/864e5)>30&&(e.dataFim="Intervalo máximo é 30 dias"):e.dataFim="Data de fim é obrigatória",t(r=>({...r,...e})),Object.keys(e).length===0},q=()=>{const e={};if(!x)e.numeroVagas="Número de vagas é obrigatório";else{const a=parseInt(x);isNaN(a)||a<=0?e.numeroVagas="Deve ser um número positivo":a>50&&(e.numeroVagas="Máximo 50 vagas")}return t(a=>({...a,...e})),Object.keys(e).length===0},J=()=>{const e={};return!p&&u.length===0&&(e.setores="Selecione ao menos um setor"),t(a=>({...a,...e})),Object.keys(e).length===0},K=()=>{const e=z(),a=P(),r=q(),F=J();return e&&a&&r&&F},O=n.useMemo(()=>{const e=Object.keys(o).length>0,a=c&&l&&x&&(p||u.length>0);return d==="custom"?a&&m&&h&&!e:a&&!e},[c,l,x,u,p,m,h,d,o]),Q=e=>{u.includes(e)?g(u.filter(a=>a!==e)):g([...u,e])},U=e=>{M(e),g(e?C:[])},W=async()=>{if(!K()){$.error("Corrija os erros antes de salvar");return}try{await G({horaInicio:c,horaFim:l,vagasTotal:parseInt(x),setores:p?C:u,cor:H,tipoRecorrencia:d,dataInicio:d==="custom"?m:void 0,dataFim:d==="custom"?h:void 0}),I("09:00"),S("11:00"),y("uteis"),T(""),V(""),w("5"),k(D[0].valor),g([]),M(!1),t({}),B?.(),f()}catch(e){$.error("Erro ao criar turno. Tente novamente."),console.error("Erro ao criar turno:",e)}},X=e=>{e||(t({}),f())};return s.jsx(ee,{open:L,onOpenChange:X,children:s.jsxs(se,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(ae,{children:[s.jsx(re,{children:"Configurar Novo Turno"}),s.jsx(oe,{children:"Configure os detalhes do turno para os funcionários."})]}),s.jsxs("div",{className:"space-y-6 py-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"horaInicio",children:"Hora de Início"}),s.jsx(j,{id:"horaInicio",type:"time",value:c,onChange:e=>{I(e.target.value),t(a=>{const r={...a};return delete r.horaInicio,r})},className:o.horaInicio?"border-red-500 focus:border-red-500":""}),o.horaInicio&&s.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[s.jsx(v,{className:"h-4 w-4"}),o.horaInicio]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"horaFim",children:"Hora de Fim"}),s.jsx(j,{id:"horaFim",type:"time",value:l,onChange:e=>{S(e.target.value),t(a=>{const r={...a};return delete r.horaFim,r})},className:o.horaFim?"border-red-500 focus:border-red-500":""}),o.horaFim&&s.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[s.jsx(v,{className:"h-4 w-4"}),o.horaFim]})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(i,{children:"Recorrência"}),s.jsxs(te,{value:d,onValueChange:e=>y(e),children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(b,{value:"todos",id:"todos"}),s.jsx(i,{htmlFor:"todos",className:"cursor-pointer font-normal",children:"Todos os dias"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(b,{value:"uteis",id:"uteis"}),s.jsx(i,{htmlFor:"uteis",className:"cursor-pointer font-normal",children:"Dias úteis (Seg-Sex)"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(b,{value:"custom",id:"custom"}),s.jsx(i,{htmlFor:"custom",className:"cursor-pointer font-normal",children:"Definir datas"})]})]}),d==="custom"&&s.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"dataInicio",children:"Data de Início"}),s.jsx(j,{id:"dataInicio",type:"date",value:m,onChange:e=>{T(e.target.value),t(a=>{const r={...a};return delete r.dataInicio,r})},className:o.dataInicio?"border-red-500 focus:border-red-500":""}),o.dataInicio&&s.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[s.jsx(v,{className:"h-4 w-4"}),o.dataInicio]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"dataFim",children:"Data de Fim"}),s.jsx(j,{id:"dataFim",type:"date",value:h,onChange:e=>{V(e.target.value),t(a=>{const r={...a};return delete r.dataFim,r})},className:o.dataFim?"border-red-500 focus:border-red-500":""}),o.dataFim&&s.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[s.jsx(v,{className:"h-4 w-4"}),o.dataFim]})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"numeroVagas",children:"Número de Vagas"}),s.jsx(j,{id:"numeroVagas",type:"number",min:"1",max:"50",value:x,onChange:e=>{w(e.target.value),t(a=>{const r={...a};return delete r.numeroVagas,r})},className:`max-w-[150px] ${o.numeroVagas?"border-red-500 focus:border-red-500":""}`}),o.numeroVagas&&s.jsxs("p",{className:"text-sm text-red-500 flex items-center gap-1",children:[s.jsx(v,{className:"h-4 w-4"}),o.numeroVagas]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(i,{children:"Cor do Turno"}),s.jsx("div",{className:"flex gap-3",children:D.map(e=>s.jsx("button",{type:"button",onClick:()=>k(e.valor),className:`
                    w-12 h-12 rounded-lg border-2 transition-all
                    ${H===e.valor?"border-neutral-900 scale-110":"border-neutral-300"}
                  `,style:{backgroundColor:e.valor},title:e.nome},e.valor))})]}),s.jsxs("div",{className:`space-y-3 p-4 rounded-lg ${o.setores?"bg-red-50 border border-red-200":"bg-neutral-50"}`,children:[s.jsx(i,{className:o.setores?"text-red-700":"",children:"Limitar Setores"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(E,{id:"todos-setores",checked:p,onCheckedChange:e=>{U(e===!0),t(a=>{const r={...a};return delete r.setores,r})}}),s.jsx(i,{htmlFor:"todos-setores",className:"cursor-pointer font-normal",children:"Todos"})]}),C.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(E,{id:e,checked:u.includes(e),onCheckedChange:()=>{Q(e),t(a=>{const r={...a};return delete r.setores,r})}}),s.jsx(i,{htmlFor:e,className:"cursor-pointer font-normal",children:e})]},e))]}),o.setores&&s.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1 mt-2",children:[s.jsx(v,{className:"h-4 w-4"}),o.setores]})]})]}),s.jsxs(ie,{children:[s.jsx(A,{variant:"outline",onClick:f,disabled:N,children:"Cancelar"}),s.jsx(A,{onClick:W,className:"bg-primary hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",disabled:N||!O,title:O?"":"Corrija os erros antes de salvar",children:N?s.jsxs(s.Fragment,{children:[s.jsx(ne,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvando..."]}):"Salvar Turno"})]})]})})}export{le as ModalCriarTurno};
