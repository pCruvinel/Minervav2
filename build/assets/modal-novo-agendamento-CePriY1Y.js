import{r as m,i as Q,k as U,j as e,D as W,a as X,b as Z,c as _,d as ee,l as re,m as A,L as p,S as g,n as j,o as v,p as N,q as b,C as f,g as ae,B as k,h as se,t as S}from"./index-Cz2i3pPJ.js";const H=["Vistoria Inicial","Apresentação de Proposta","Vistoria Técnica","Visita Semanal"],oe=["Assessoria","Comercial","Obras"];function te({open:I,onClose:T,turno:o,dia:$,onSuccess:E}){const[h,C]=m.useState(""),[d,F]=m.useState(""),[n,x]=m.useState(""),[l,D]=m.useState("1"),[i,c]=m.useState({}),{mutate:L,loading:y}=Q(),M=U();m.useEffect(()=>{I&&o&&(x(o.horaInicio),c({}))},[I,o]);const P=()=>{const r={};return h?H.includes(h)||(r.categoria="Categoria inválida"):r.categoria="Selecione uma categoria",c(a=>({...a,...r})),Object.keys(r).length===0},B=()=>{const r={};return d?o?.setores?.includes(d)||(r.setor=`O setor ${d} não está permitido neste turno`):r.setor="Selecione um setor",c(a=>({...a,...r})),Object.keys(r).length===0},q=()=>{const r={};if(!n)r.horarioInicio="Selecione o horário de início";else if(!o)r.horarioInicio="Turno inválido";else{const[a]=n.split(":").map(Number),[s]=o.horaInicio.split(":").map(Number),[t]=o.horaFim.split(":").map(Number);(a<s||a>=t)&&(r.horarioInicio="O horário deve estar dentro do turno")}return c(a=>({...a,...r})),Object.keys(r).length===0},R=()=>{const r={};if(!l)r.duracao="Selecione a duração";else{if(!o||!n)return!0;{const a=parseInt(l),[s]=n.split(":").map(Number),[t]=o.horaFim.split(":").map(Number);s+a>t&&(r.duracao=`Duração máxima é ${t-s}h para este horário`)}}return c(a=>({...a,...r})),Object.keys(r).length===0},Y=()=>{const r=P(),a=B(),s=q(),t=R();return r&&a&&s&&t},w=m.useMemo(()=>{const r=Object.keys(i).length>0;return h&&d&&n&&l&&!r},[h,d,n,l,i]),z=r=>{const a=String(r.getDate()).padStart(2,"0"),s=String(r.getMonth()+1).padStart(2,"0"),t=String(r.getFullYear()).slice(-2);return`${a}-${s}-${t}`},V=()=>{if(!n)return"--:--";const[r,a]=n.split(":").map(Number),s=r+parseInt(l);return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}`},G=()=>{if(!o)return[];const[r]=o.horaInicio.split(":").map(Number),[a]=o.horaFim.split(":").map(Number),s=[];for(let t=r;t<a;t++)s.push(`${String(t).padStart(2,"0")}:00`);return s},J=()=>{if(!o||!n)return[1];const[r]=n.split(":").map(Number),[a]=o.horaFim.split(":").map(Number),s=a-r,t=[];for(let u=1;u<=s;u++)t.push(u);return t},K=async()=>{if(!Y()){S.error("Corrija os erros antes de confirmar");return}if(!o?.id){S.error("Turno inválido");return}try{const r=V(),a=$.toISOString().split("T")[0];if(!await M(o.id,a,n,r)){S.error("Não há vagas disponíveis neste horário");return}await L({turnoId:o.id,data:a,horarioInicio:n,horarioFim:r,duracaoHoras:parseInt(l),categoria:h,setor:d}),C(""),F(""),x(""),D("1"),c({}),E?.(),T()}catch(r){S.error("Erro ao criar agendamento. Tente novamente."),console.error("Erro ao criar agendamento:",r)}},O=()=>{C(""),F(""),x(""),D("1"),c({}),T()};return o?e.jsx(W,{open:I,onOpenChange:O,children:e.jsxs(X,{className:"max-w-md",children:[e.jsxs(Z,{children:[e.jsx(_,{children:"Novo Agendamento"}),e.jsx(ee,{children:"Confirme os detalhes do agendamento para o turno selecionado."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"bg-neutral-100 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(re,{className:"h-4 w-4 text-neutral-600"}),e.jsxs("span",{children:["Data: ",z($)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"h-4 w-4 text-neutral-600"}),e.jsxs("span",{children:["Turno Selecionado: ",o.horaInicio," - ",o.horaFim]})]}),e.jsxs("div",{className:"text-sm text-neutral-600",children:["Vagas disponíveis: ",o.vagasTotal-o.vagasOcupadas," de ",o.vagasTotal]})]}),e.jsxs("div",{className:`space-y-2 p-3 rounded-lg ${i.categoria?"bg-red-50 border border-red-200":""}`,children:[e.jsx(p,{htmlFor:"categoria",className:i.categoria?"text-red-700":"",children:"Categoria *"}),e.jsxs(g,{value:h,onValueChange:r=>{C(r),c(a=>{const s={...a};return delete s.categoria,s})},children:[e.jsx(j,{id:"categoria",className:i.categoria?"border-red-500":"",children:e.jsx(v,{placeholder:"Selecione a categoria"})}),e.jsx(N,{children:H.map(r=>e.jsx(b,{value:r,children:r},r))})]}),i.categoria&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(f,{className:"h-4 w-4"}),i.categoria]})]}),e.jsxs("div",{className:`space-y-2 p-3 rounded-lg ${i.setor?"bg-red-50 border border-red-200":""}`,children:[e.jsx(p,{htmlFor:"setor",className:i.setor?"text-red-700":"",children:"Setor *"}),e.jsxs(g,{value:d,onValueChange:r=>{F(r),c(a=>{const s={...a};return delete s.setor,s})},children:[e.jsx(j,{id:"setor",className:i.setor?"border-red-500":"",children:e.jsx(v,{placeholder:"Selecione o setor"})}),e.jsx(N,{children:oe.filter(r=>o.setores.includes(r)).map(r=>e.jsx(b,{value:r,children:r},r))})]}),e.jsxs("p",{className:"text-xs text-neutral-600",children:["Setores permitidos: ",o.setores.join(", ")]}),i.setor&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(f,{className:"h-4 w-4"}),i.setor]})]}),e.jsxs("div",{className:`space-y-2 p-3 rounded-lg ${i.horarioInicio?"bg-red-50 border border-red-200":""}`,children:[e.jsx(p,{htmlFor:"horarioInicio",className:i.horarioInicio?"text-red-700":"",children:"Horário de Início *"}),e.jsxs(g,{value:n,onValueChange:r=>{x(r),c(a=>{const s={...a};return delete s.horarioInicio,s})},children:[e.jsx(j,{id:"horarioInicio",className:i.horarioInicio?"border-red-500":"",children:e.jsx(v,{placeholder:"Selecione o horário de início"})}),e.jsx(N,{children:G().map(r=>e.jsx(b,{value:r,children:r},r))})]}),i.horarioInicio&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(f,{className:"h-4 w-4"}),i.horarioInicio]})]}),e.jsxs("div",{className:`space-y-2 p-3 rounded-lg ${i.duracao?"bg-red-50 border border-red-200":""}`,children:[e.jsx(p,{htmlFor:"duracao",className:i.duracao?"text-red-700":"",children:"Duração (horas) *"}),e.jsxs(g,{value:l,onValueChange:r=>{D(r),c(a=>{const s={...a};return delete s.duracao,s})},children:[e.jsx(j,{id:"duracao",className:i.duracao?"border-red-500":"",children:e.jsx(v,{placeholder:"Selecione a duração"})}),e.jsx(N,{children:J().map(r=>e.jsx(b,{value:`${r}`,children:`${r}h`},r))})]}),i.duracao&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-1",children:[e.jsx(f,{className:"h-4 w-4"}),i.duracao]})]}),e.jsx("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Horário do agendamento"}),e.jsxs("p",{className:"font-medium",children:[n," - ",V()]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-neutral-600",children:"Duração"}),e.jsxs("p",{className:"font-medium",children:[l,"h"]})]})]})})]}),e.jsxs(ae,{children:[e.jsx(k,{variant:"outline",onClick:O,disabled:y,children:"Cancelar"}),e.jsx(k,{onClick:K,className:"bg-primary hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",disabled:y||!w,title:w?"":"Corrija os erros antes de confirmar",children:y?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmando..."]}):"Confirmar Agendamento"})]})]})}):null}export{te as ModalNovoAgendamento};
